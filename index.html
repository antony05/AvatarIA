
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Asistente Virtual 3D</title>
  <script src="https://unpkg.com/@readyplayerme/viseme"></script>
  <style>
    body { margin: 0; background: #000; color: white; text-align: center; font-family: sans-serif; }
    iframe { width: 100%; height: 80vh; border: none; }
    button { font-size: 1.2em; padding: 10px 20px; margin-top: 10px; }
    #respuesta { padding: 1em; font-size: 1.1em; }
  </style>
</head>
<body>

  <h1>Asistente Virtual 3D</h1>
<iframe
  id="avatar"
  allow="camera *; microphone *;"
  src="https://avataria-3hmq26.readyplayer.me/avatar?id=685d8bb755c53bb7da26f799&frameApi"
></iframe>


  <div id="respuesta">Presion치 el bot칩n y habl치</div>
  <button onclick="iniciarHabla()">游꿗 Hablar</button>

  <script>
    const iframe = document.getElementById('avatar');
    const respuestaDiv = document.getElementById('respuesta');
    let avatarLoaded = false;

    window.addEventListener('message', (event) => {
      if (event.data.source === 'readyplayerme') {
        if (event.data.eventName === 'v1.frame.ready') {
          iframe.contentWindow.postMessage({ target: 'readyplayerme', type: 'subscribe', eventName: 'v1.avatar.exported' }, '*');
          iframe.contentWindow.postMessage({ target: 'readyplayerme', type: 'subscribe', eventName: 'v1.user.set' }, '*');
        }
        if (event.data.eventName === 'v1.avatar.exported') {
          avatarLoaded = true;
        }
      }
    });

    function iniciarHabla() {
      const reconocimiento = new (webkitSpeechRecognition || SpeechRecognition)();
      reconocimiento.lang = 'es-ES';
      reconocimiento.start();

      reconocimiento.onresult = async (evento) => {
        const textoUsuario = evento.results[0][0].transcript;
        respuestaDiv.textContent = `T칰 dijiste: ${textoUsuario}`;

        const textoRespuesta = "Hola, soy tu asistente virtual. Todav칤a no tengo conexi칩n con OpenAI, pero puedo hablar contigo localmente.";
        respuestaDiv.textContent = textoRespuesta;

        const mensaje = new SpeechSynthesisUtterance(textoRespuesta);
        mensaje.lang = 'es-ES';

        mensaje.onstart = () => {
          iframe.contentWindow.postMessage({
            target: 'readyplayerme',
            type: 'v1.viseme.start',
            payload: { text: textoRespuesta }
          }, '*');
        };
        mensaje.onend = () => {
          iframe.contentWindow.postMessage({
            target: 'readyplayerme',
            type: 'v1.viseme.stop'
          }, '*');
        };

        speechSynthesis.speak(mensaje);
      };

      reconocimiento.onerror = () => {
        respuestaDiv.textContent = "Error al reconocer la voz. Intenta de nuevo.";
      };
    }
  </script>
</body>
</html>
